import{x as F,r as n,A as y,G as R,e as G,c as u,a as e,u as r,f as I,t as d,h as k,v as T,i as w,H as z,F as A,E as U,d as h,o as c,C as S,I as H}from"./DF66RuPJ.js";import{u as q}from"./CYNNm3xl.js";const Q={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12"},O={key:0,class:"flex justify-center items-center py-12"},J={key:1,class:"space-y-6"},K={class:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8"},W={class:"bg-white dark:bg-gray-800 overflow-hidden shadow rounded-lg"},X={class:"p-5"},Y={class:"flex items-center"},Z={class:"ml-5 w-0 flex-1"},ee={class:"text-lg font-medium text-gray-900 dark:text-white"},te={class:"bg-white dark:bg-gray-800 overflow-hidden shadow rounded-lg"},se={class:"p-5"},re={class:"flex items-center"},ae={class:"ml-5 w-0 flex-1"},oe={class:"text-lg font-medium text-gray-900 dark:text-white"},de={class:"bg-white dark:bg-gray-800 overflow-hidden shadow rounded-lg"},le={class:"p-5"},ie={class:"flex items-center"},ne={class:"ml-5 w-0 flex-1"},ue={class:"text-lg font-medium text-gray-900 dark:text-white"},ce={class:"bg-white dark:bg-gray-800 overflow-hidden shadow rounded-lg"},me={class:"p-5"},ge={class:"flex items-center"},xe={class:"ml-5 w-0 flex-1"},pe={class:"text-lg font-medium text-gray-900 dark:text-white"},ye={class:"bg-white dark:bg-gray-800 shadow rounded-lg p-6"},ve={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},be={class:"bg-white dark:bg-gray-800 shadow overflow-hidden sm:rounded-md"},he={class:"px-4 py-5 sm:p-6"},fe={class:"overflow-x-auto"},ke={class:"min-w-full divide-y divide-gray-200 dark:divide-gray-700"},we={class:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700"},_e={class:"px-6 py-4 whitespace-nowrap"},Ce={class:"flex items-center"},Me={class:"flex-shrink-0 h-10 w-10"},ze={class:"h-10 w-10 rounded-full bg-blue-100 dark:bg-blue-900 flex items-center justify-center"},Ae={class:"text-blue-600 dark:text-blue-300 font-medium text-sm"},Ue={class:"ml-4"},Se={class:"text-sm font-medium text-gray-900 dark:text-white"},Be={class:"text-sm text-gray-500 dark:text-gray-400"},Pe={class:"px-6 py-4 whitespace-nowrap"},$e={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white"},je={class:"flex items-center"},Ve={class:"mr-2"},Ee={class:"w-16 bg-gray-200 dark:bg-gray-700 rounded-full h-2"},Le={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white"},Ne={class:"text-xs text-gray-500 dark:text-gray-400"},De={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400"},Fe={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},Re=["onClick","disabled"],Ge={key:0,class:"bg-white dark:bg-gray-800 px-4 py-3 flex items-center justify-between border-t border-gray-200 dark:border-gray-700 sm:px-6 rounded-lg shadow"},Ie={class:"flex-1 flex justify-between sm:hidden"},Te=["disabled"],He=["disabled"],qe={class:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between"},Qe={class:"text-sm text-gray-700 dark:text-gray-300"},Oe={class:"font-medium"},Je={class:"font-medium"},Ke={class:"font-medium"},We={class:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px"},Xe=["disabled"],Ye=["onClick"],Ze=["disabled"],rt={__name:"users",setup(et){const{$api:_}=F(),{user:B}=q(),i=n([]),f=n(!0),o=n(1),m=n(1),b=n(0),g=n(""),x=n(""),v=n("email"),C=y(()=>B.value?.id),P=y(()=>i.value.filter(a=>a.role==="admin").length),$=y(()=>i.value.reduce((a,t)=>a+t.totalSpins,0)),j=y(()=>i.value.reduce((a,t)=>a+t.claimedPrizes,0)),V=y(()=>{let a=i.value;return g.value&&(a=a.filter(t=>t.email.toLowerCase().includes(g.value.toLowerCase()))),x.value&&(a=a.filter(t=>t.role===x.value)),a.sort((t,s)=>{switch(v.value){case"email":return t.email.localeCompare(s.email);case"spins":return s.totalSpins-t.totalSpins;case"role":return t.role.localeCompare(s.role);default:return 0}}),a}),E=y(()=>{const a=[],t=Math.max(1,o.value-2),s=Math.min(m.value,o.value+2);for(let l=t;l<=s;l++)a.push(l);return a}),M=async(a=1)=>{try{f.value=!0;const t=await _.get(`/admin/users?page=${a}&limit=10`,{withCredentials:!0});i.value=t.data.users,o.value=t.data.currentPage,m.value=t.data.totalPages,b.value=t.data.total}catch(t){console.error("Error loading users:",t)}finally{f.value=!1}},p=a=>{M(a)},L=async a=>{if(a._id===C.value)return;const t=a.role==="admin"?"user":"admin";if(confirm(`Â¿EstÃ¡s seguro de que quieres ${t==="admin"?"convertir en administrador":"quitar privilegios de administrador"} a ${a.email}?`))try{await _.put(`/admin/users/${a._id}/role`,{role:t},{withCredentials:!0});const l=i.value.findIndex(D=>D._id===a._id);l!==-1&&(i.value[l].role=t)}catch(l){console.error("Error updating user role:",l),alert(l.response?.data?.message||"Error al actualizar el rol del usuario")}},N=a=>new Date(a).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return R([g,x,v],()=>{o.value!==1&&p(1)}),G(()=>{M()}),(a,t)=>(c(),u("div",Q,[t[28]||(t[28]=e("div",{class:"mb-8"},[e("h1",{class:"text-3xl font-bold text-gray-900 dark:text-white"}," ðŸ‘¥ GestiÃ³n de Usuarios "),e("p",{class:"mt-2 text-gray-600 dark:text-gray-400"}," Administra los usuarios y sus estadÃ­sticas ")],-1)),r(f)?(c(),u("div",O,[...t[7]||(t[7]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"},null,-1)])])):(c(),u("div",J,[e("div",K,[e("div",W,[e("div",X,[e("div",Y,[t[9]||(t[9]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-6 w-6 text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"})])],-1)),e("div",Z,[e("dl",null,[t[8]||(t[8]=e("dt",{class:"text-sm font-medium text-gray-500 dark:text-gray-400 truncate"}," Total Usuarios ",-1)),e("dd",ee,d(r(b)),1)])])])])]),e("div",te,[e("div",se,[e("div",re,[t[11]||(t[11]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-6 w-6 text-green-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"})])],-1)),e("div",ae,[e("dl",null,[t[10]||(t[10]=e("dt",{class:"text-sm font-medium text-gray-500 dark:text-gray-400 truncate"}," Administradores ",-1)),e("dd",oe,d(r(P)),1)])])])])]),e("div",de,[e("div",le,[e("div",ie,[t[13]||(t[13]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-6 w-6 text-yellow-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 10V3L4 14h7v7l9-11h-7z"})])],-1)),e("div",ne,[e("dl",null,[t[12]||(t[12]=e("dt",{class:"text-sm font-medium text-gray-500 dark:text-gray-400 truncate"}," Giros Totales ",-1)),e("dd",ue,d(r($)),1)])])])])]),e("div",ce,[e("div",me,[e("div",ge,[t[15]||(t[15]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-6 w-6 text-purple-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v13m0-13V6a2 2 0 112 2h-2zm0 0V5.5A2.5 2.5 0 109.5 8H12zm-7 4h14M5 12a2 2 0 110-4h14a2 2 0 110 4M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"})])],-1)),e("div",xe,[e("dl",null,[t[14]||(t[14]=e("dt",{class:"text-sm font-medium text-gray-500 dark:text-gray-400 truncate"}," Premios Reclamados ",-1)),e("dd",pe,d(r(j)),1)])])])])])]),e("div",ye,[e("div",ve,[e("div",null,[t[16]||(t[16]=e("label",{for:"search",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"}," Buscar por email ",-1)),k(e("input",{id:"search","onUpdate:modelValue":t[0]||(t[0]=s=>w(g)?g.value=s:null),type:"text",placeholder:"Buscar usuario...",class:"mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white sm:text-sm"},null,512),[[T,r(g)]])]),e("div",null,[t[18]||(t[18]=e("label",{for:"roleFilter",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"}," Filtrar por rol ",-1)),k(e("select",{id:"roleFilter","onUpdate:modelValue":t[1]||(t[1]=s=>w(x)?x.value=s:null),class:"mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white sm:text-sm"},[...t[17]||(t[17]=[e("option",{value:""},"Todos los roles",-1),e("option",{value:"user"},"Usuario",-1),e("option",{value:"admin"},"Administrador",-1)])],512),[[z,r(x)]])]),e("div",null,[t[20]||(t[20]=e("label",{for:"sortBy",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"}," Ordenar por ",-1)),k(e("select",{id:"sortBy","onUpdate:modelValue":t[2]||(t[2]=s=>w(v)?v.value=s:null),class:"mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white sm:text-sm"},[...t[19]||(t[19]=[e("option",{value:"email"},"Email",-1),e("option",{value:"spins"},"NÃºmero de giros",-1),e("option",{value:"role"},"Rol",-1)])],512),[[z,r(v)]])])])]),e("div",be,[e("div",he,[e("div",fe,[e("table",ke,[t[21]||(t[21]=e("thead",{class:"bg-gray-50 dark:bg-gray-700"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"}," Usuario "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"}," Rol "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"}," Giros "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"}," Premios "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"}," Ãšltimo Giro "),e("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"}," Acciones ")])],-1)),e("tbody",we,[(c(!0),u(A,null,U(r(V),s=>(c(),u("tr",{key:s._id},[e("td",_e,[e("div",Ce,[e("div",Me,[e("div",ze,[e("span",Ae,d(s.email.charAt(0).toUpperCase()),1)])]),e("div",Ue,[e("div",Se,d(s.email),1),e("div",Be," ID: "+d(s._id?s._id.slice(-6):"N/A"),1)])])]),e("td",Pe,[e("span",{class:S(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",s.role==="admin"?"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200":"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200"])},d(s.role==="admin"?"Administrador":"Usuario"),3)]),e("td",$e,[e("div",je,[e("span",Ve,d(s.totalSpins),1),e("div",Ee,[e("div",{class:"bg-yellow-400 h-2 rounded-full",style:H({width:`${Math.min(s.totalSpins/Math.max(...r(i).map(l=>l.totalSpins))*100,100)}%`})},null,4)])])]),e("td",Le,[e("div",null,[e("div",null,d(s.claimedPrizes)+" reclamados",1),e("div",Ne,d(s.pendingPrizes)+" pendientes ",1)])]),e("td",De,d(s.lastSpin?N(s.lastSpin):"Nunca"),1),e("td",Fe,[e("button",{onClick:l=>L(s),disabled:s._id===r(C),class:"text-blue-600 hover:text-blue-900 dark:text-blue-400 dark:hover:text-blue-200 disabled:opacity-50 disabled:cursor-not-allowed"},d(s.role==="admin"?"Quitar Admin":"Hacer Admin"),9,Re)])]))),128))])])])])]),r(m)>1?(c(),u("div",Ge,[e("div",Ie,[e("button",{onClick:t[3]||(t[3]=s=>r(o)>1&&p(r(o)-1)),disabled:r(o)<=1,class:"relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50"}," Anterior ",8,Te),e("button",{onClick:t[4]||(t[4]=s=>r(o)<r(m)&&p(r(o)+1)),disabled:r(o)>=r(m),class:"ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50"}," Siguiente ",8,He)]),e("div",qe,[e("div",null,[e("p",Qe,[t[22]||(t[22]=h(" Mostrando ",-1)),e("span",Oe,d((r(o)-1)*10+1),1),t[23]||(t[23]=h(" a ",-1)),e("span",Je,d(Math.min(r(o)*10,r(b))),1),t[24]||(t[24]=h(" de ",-1)),e("span",Ke,d(r(b)),1),t[25]||(t[25]=h(" usuarios ",-1))])]),e("div",null,[e("nav",We,[e("button",{onClick:t[5]||(t[5]=s=>r(o)>1&&p(r(o)-1)),disabled:r(o)<=1,class:"relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-sm font-medium text-gray-500 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-600 disabled:opacity-50"},[...t[26]||(t[26]=[e("svg",{class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z","clip-rule":"evenodd"})],-1)])],8,Xe),(c(!0),u(A,null,U(r(E),s=>(c(),u("button",{key:s,onClick:l=>p(s),class:S(["relative inline-flex items-center px-4 py-2 border text-sm font-medium",s===r(o)?"z-10 bg-blue-50 dark:bg-blue-900 border-blue-500 dark:border-blue-400 text-blue-600 dark:text-blue-200":"bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-500 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-600"])},d(s),11,Ye))),128)),e("button",{onClick:t[6]||(t[6]=s=>r(o)<r(m)&&p(r(o)+1)),disabled:r(o)>=r(m),class:"relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-sm font-medium text-gray-500 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-600 disabled:opacity-50"},[...t[27]||(t[27]=[e("svg",{class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z","clip-rule":"evenodd"})],-1)])],8,Ze)])])])])):I("",!0)]))]))}};export{rt as default};

const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./Dx6csrWC.js","./DF66RuPJ.js"])))=>i.map(i=>d[i]);
import{x as E,r as u,e as z,z as W,A as F,c as i,o as a,a as e,f as y,j as I,u as r,B as L,d as S,t as f,C as O,D as T}from"./DF66RuPJ.js";const H={class:"flex flex-col items-center space-y-8"},G={class:"relative"},U={key:1,class:"w-96 h-96 rounded-full border-8 border-gray-300 animate-pulse flex items-center justify-center"},Y=["disabled"],q={key:0},J={key:1,class:"flex items-center"},K={key:0,class:"text-center"},Q={class:"text-sm text-gray-600 dark:text-gray-400"},X={key:1,class:"fixed top-4 right-4 z-50 max-w-sm"},Z={class:"flex items-start"},ee={class:"flex-shrink-0"},te={key:0,class:"text-green-500 text-xl"},se={key:1,class:"text-red-500 text-xl"},oe={key:2,class:"text-yellow-500 text-xl"},re={key:3,class:"text-blue-500 text-xl"},ne={class:"ml-3 flex-1"},ae={class:"font-medium"},ie={key:0,class:"mt-1 text-sm opacity-90"},ke={__name:"WheelSpinner",emits:["prize-won"],setup(b,{emit:k}){const{$api:w}=E(),p=k,x=u(null);z(async()=>{{const{Roulette:t}=await W(async()=>{const{Roulette:s}=await import("./Dx6csrWC.js");return{Roulette:s}},__vite__mapDeps([0,1]),import.meta.url);x.value=t}});const m=u(null),c=u(!1),g=u(!0),d=u(null),v=u(""),l=u(null),o=u({show:!1,type:"info",title:"",message:""}),_=(t,s,n="")=>{o.value={show:!0,type:t,title:s,message:n},setTimeout(()=>{D()},5e3)},D=()=>{o.value.show=!1},C=u([{id:1,name:"Premio 1",color:"#FF6B6B"},{id:2,name:"Premio 2",color:"#4ECDC4"},{id:3,name:"Premio 3",color:"#45B7D1"},{id:4,name:"Premio 4",color:"#96CEB4"},{id:5,name:"Premio 5",color:"#FFEAA7"},{id:6,name:"Premio 6",color:"#DDA0DD"},{id:7,name:"Premio 7",color:"#FF8A80"},{id:8,name:"Premio 8",color:"#82B1FF"}]),B=F(()=>C.value.map((t,s)=>({id:t.id,name:t.name,htmlContent:t.name,textColor:"black",background:t.color}))),P=()=>{console.log("Wheel started spinning"),_("info","üéØ Girando...","La ruleta est√° girando, ¬°buena suerte!")},A=t=>{if(console.log("Wheel stopped at:",t),c.value=!1,l.value){const s=l.value.prize?.name||"Premio desconocido";_("success","üéâ ¬°Felicidades!",`Has ganado: ${s}`),p("prize-won",l.value)}},R=async()=>{if(!(c.value||!g.value))try{c.value=!0;const t=await w.post("/spin/play",{},{withCredentials:!0});l.value=t.data.spin;const s=t.data.spin.prize,n=C.value.findIndex(h=>h.id===s._id||h.name===s.name);n!==-1?m.value.launchWheel(n):m.value.launchWheel()}catch(t){if(c.value=!1,console.error("Spin error:",t),t.response?.status===429){if(console.log("Rate limit response:",t.response.data),t.response.data.nextSpinAvailable){const s=new Date(t.response.data.nextSpinAvailable);d.value=s,g.value=!1,$()}else{const s=new Date(Date.now()+864e5);d.value=s,g.value=!1,$()}_("warning","L√≠mite de giros alcanzado",t.response?.data?.message||"Ya has usado todos tus giros de hoy. Vuelve ma√±ana.")}else _("error","Error al girar",t.response?.data?.message||"Error al girar la ruleta")}},$=()=>{const t=()=>{if(!d.value)return;const s=new Date,n=d.value-s;if(n<=0){g.value=!0,d.value=null,v.value="";return}const h=Math.floor(n/(1e3*60*60)),N=Math.floor(n%(1e3*60*60)/(1e3*60)),V=Math.floor(n%(1e3*60)/1e3);v.value=`${h.toString().padStart(2,"0")}:${N.toString().padStart(2,"0")}:${V.toString().padStart(2,"0")}`,setTimeout(t,1e3)};t()},M=async()=>{try{const s=(await w.get("/spin/prizes",{withCredentials:!0})).data.prizes.filter(n=>n.isActive&&n.stock>0);s.length>0&&(C.value=s.map((n,h)=>({id:n._id,name:n.name,color:j(h),probability:n.probability,stock:n.stock,description:n.description})))}catch(t){console.error("Error loading prizes:",t)}},j=t=>{const s=["#FF6B6B","#4ECDC4","#45B7D1","#96CEB4","#FFEAA7","#DDA0DD","#FF8A80","#82B1FF"];return s[t%s.length]};return z(()=>{M()}),(t,s)=>(a(),i("div",H,[e("div",G,[s[1]||(s[1]=e("div",{class:"absolute top-2 left-1/2 transform -translate-x-1/2 z-50 pointer-events-none"},[e("div",{class:"w-0 h-0 border-l-[12px] border-r-[12px] border-b-[20px] border-l-transparent border-r-transparent border-b-red-600 filter drop-shadow-lg"})],-1)),r(x)?(a(),I(L(r(x)),{key:0,ref_key:"wheel",ref:m,items:r(B),size:400,duration:3,"display-shadow":!0,"display-border":!0,"display-indicator":!1,"centered-indicator":!1,"base-display":!0,"base-display-indicator":!1,"base-display-shadow":!0,"indicator-position":"top",easing:"ease",onWheelStart:P,onWheelEnd:A},null,40,["items"])):(a(),i("div",U,[...s[0]||(s[0]=[e("div",{class:"text-gray-500"},"Cargando ruleta...",-1)])]))]),e("button",{onClick:R,disabled:r(c)||!r(g),class:"px-8 py-4 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white font-bold text-lg rounded-full shadow-lg transform transition-all duration-200 hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none"},[r(c)?(a(),i("span",J,[...s[2]||(s[2]=[e("svg",{class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),S(" Girando... ",-1)])])):(a(),i("span",q,"üéØ ¬°Girar Ruleta!"))],8,Y),r(d)?(a(),i("div",K,[e("p",Q," Pr√≥ximo giro disponible en: "+f(r(v)),1)])):y("",!0),r(o).show?(a(),i("div",X,[e("div",{class:O(["p-4 rounded-lg shadow-lg border-l-4 transform transition-all duration-300",r(o).type==="success"?"bg-green-50 border-green-500 text-green-800":"",r(o).type==="error"?"bg-red-50 border-red-500 text-red-800":"",r(o).type==="warning"?"bg-yellow-50 border-yellow-500 text-yellow-800":"",r(o).type==="info"?"bg-blue-50 border-blue-500 text-blue-800":""])},[e("div",Z,[e("div",ee,[r(o).type==="success"?(a(),i("span",te,"‚úÖ")):r(o).type==="error"?(a(),i("span",se,"‚ùå")):r(o).type==="warning"?(a(),i("span",oe,"‚ö†Ô∏è")):r(o).type==="info"?(a(),i("span",re,"‚ÑπÔ∏è")):y("",!0)]),e("div",ne,[e("p",ae,f(r(o).title),1),r(o).message?(a(),i("p",ie,f(r(o).message),1)):y("",!0)]),e("button",{onClick:D,class:"ml-4 text-gray-400 hover:text-gray-600 transition-colors"}," ‚úï ")])],2)])):y("",!0)]))}},le={key:0,class:"fixed inset-0 z-50 overflow-y-auto","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true"},de={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},ce={class:"inline-block align-bottom bg-white dark:bg-gray-800 rounded-lg px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full sm:p-6 animate-bounce-in"},ue={class:"sm:flex sm:items-start"},me={class:"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left"},pe={class:"mt-2"},ge={class:"mt-4 p-4 bg-gradient-to-r from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20 rounded-lg border border-blue-200 dark:border-blue-700"},fe={class:"text-xl font-bold text-gray-900 dark:text-white mb-2"},xe={key:0,class:"text-gray-600 dark:text-gray-300"},he={class:"mt-4 text-xs text-gray-500 dark:text-gray-400"},ye={class:"mt-5 sm:mt-4 sm:flex sm:flex-row-reverse"},be=["disabled"],ve={key:0},we={key:1,class:"flex items-center"},Ce={__name:"PrizeModal",props:{isOpen:{type:Boolean,default:!1},spin:{type:Object,default:null}},emits:["close","prize-claimed"],setup(b,{emit:k}){const{$api:w}=E(),p=b,x=k,m=u(!1),c=F(()=>p.spin?.prize),g=l=>l?new Date(l).toLocaleString("es-ES",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"",d=()=>{x("close")},v=async()=>{if(p.spin?.id)try{m.value=!0,await w.put(`/spin/${p.spin.id}/claim`,{},{withCredentials:!0}),x("prize-claimed",p.spin),d()}catch(l){console.error("Error claiming prize:",l),alert(l.response?.data?.message||"Error al reclamar el premio")}finally{m.value=!1}};return z(()=>{const l=o=>{o.key==="Escape"&&p.isOpen&&d()};document.addEventListener("keydown",l),T(()=>{document.removeEventListener("keydown",l)})}),(l,o)=>b.isOpen?(a(),i("div",le,[e("div",de,[e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity","aria-hidden":"true",onClick:d}),e("div",ce,[e("div",ue,[o[2]||(o[2]=e("div",{class:"mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-green-100 dark:bg-green-900 sm:mx-0 sm:h-10 sm:w-10"},[e("svg",{class:"h-6 w-6 text-green-600 dark:text-green-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),e("div",me,[o[1]||(o[1]=e("h3",{class:"text-lg leading-6 font-medium text-gray-900 dark:text-white",id:"modal-title"}," üéâ ¬°Felicitaciones! ",-1)),e("div",pe,[o[0]||(o[0]=e("p",{class:"text-sm text-gray-500 dark:text-gray-400"}," Has ganado un premio incre√≠ble: ",-1)),e("div",ge,[e("h4",fe,f(r(c)?.name),1),r(c)?.description?(a(),i("p",xe,f(r(c).description),1)):y("",!0)]),e("div",he,[e("p",null,"Fecha: "+f(g(b.spin?.date)),1),e("p",null,"ID del giro: "+f(b.spin?.id),1)])])])]),e("div",ye,[e("button",{type:"button",class:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:ml-3 sm:w-auto sm:text-sm transition-colors duration-200",onClick:v,disabled:r(m)},[r(m)?(a(),i("span",we,[...o[3]||(o[3]=[e("svg",{class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),S(" Reclamando... ",-1)])])):(a(),i("span",ve,"üéÅ Reclamar Premio"))],8,be),e("button",{type:"button",class:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 dark:border-gray-600 shadow-sm px-4 py-2 bg-white dark:bg-gray-700 text-base font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:mt-0 sm:w-auto sm:text-sm transition-colors duration-200",onClick:d}," Cerrar ")])])])])):y("",!0)}};export{Ce as _,ke as a};
